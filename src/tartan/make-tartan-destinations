#!/usr/bin/env python3
# -*- coding: utf-8 -*-

import csv
import ipaddress
import netifaces
import os
import socket
import sys


resultsDirectory = '/home/dreibh/tartan'

destinations = [
   [ 'bits-pilani.ac.in', 'India' ],
   [ 'linux.conf.au', 'Australia' ],
   [ 'linux.org.au', 'Australia' ],
   [ 'nus.edu.sg', 'Singapore' ],
   [ 'shirazu.ac.ir', 'Iran' ],
   [ 'voyager.ce.fit.ac.jp', 'Japan' ],
   [ 'www.airkoryo.com.kp', 'North Korea' ],
   [ 'www.cbs.dk', 'Denmark' ],
   [ 'www.fesb.unist.hr', 'Croatia' ],
   [ 'www.hainanu.edu.cn', 'China' ],
   [ 'www.heise.de', 'Germany' ],
   [ 'www.ietf.org', 'USA'],
   [ 'www.nntb.no', 'Norway' ],
   [ 'www.nu.edu.kz', 'Kazakhstan' ],
   [ 'www.opt.pf', 'French Polynesia' ],
   [ 'www.ostfalia.de', 'Germany' ],
   [ 'www.rta.ae', 'United Arab Emirates' ],
   [ 'www.uni-due.de', 'Germany' ],
   [ 'www.zim.uni-due.de', 'Germany' ],

   [ 'anorien.csc.warwick.ac.uk', 'United Kingdom' ],
   [ 'archive.linux.duke.edu', 'USA' ],
   [ 'bay.uchicago.edu', 'USA' ],
   [ 'brieger.esalq.usp.br', 'Brazil' ],
   [ 'cloud.r-project.org', '0-Cloud' ],
   [ 'cran-r.c3sl.ufpr.br', 'Brazil' ],
   [ 'cran.asia', '0-Cloud-East-Asia' ],
   [ 'cran.asia', 'Korea' ],
   [ 'cran.biotools.fr', 'France' ],
   [ 'cran.case.edu', 'USA' ],
   [ 'cran.csie.ntu.edu.tw', 'Taiwan' ],
   [ 'cran.csiro.au', 'Australia' ],
   [ 'cran.curtin.edu.au', 'Australia' ],
   [ 'cran.dcc.uchile.cl', 'Chile' ],
   [ 'cran.gedik.edu.tr', 'Turkey' ],
   [ 'cran.hafro.is', 'Iceland' ],
   [ 'cran.icts.res.in', 'India' ],
   [ 'cran.irsn.fr', 'France' ],
   [ 'cran.ism.ac.jp', 'Japan' ],
   [ 'cran.itam.mx', 'Mexico' ],
   [ 'cran.ma.imperial.ac.uk', 'UK' ],
   [ 'cran.mi2.ai', 'Poland' ],
   [ 'cran.mirror.ac.za', 'South Africa' ],
   [ 'cran.mirror.garr.it', 'Italy' ],
   [ 'cran.mirrors.hoobly.com', 'USA' ],
   [ 'cran.ms.unimelb.edu.au', 'Australia' ],
   [ 'cran.ncc.metu.edu.tr', 'Turkey' ],
   [ 'cran.nyuad.nyu.edu', 'United Arab Emirates' ],
   [ 'cran.pau.edu.tr', 'Turkey' ],
   [ 'cran.radicaldevelop.com', 'Portugal' ],
   [ 'cran.rapporter.net', 'Hungary' ],
   [ 'cran.rediris.es', 'Spain' ],
   [ 'cran.stat.auckland.ac.nz', 'New Zealand' ],
   [ 'cran.stat.unipd.it', 'Italy' ],
   [ 'cran.stat.upd.edu.ph', 'Philippines' ],
   [ 'cran.uib.no', 'Norway' ],
   [ 'cran.um.ac.ir', 'Iran' ],
   [ 'cran.uni-muenster.de', 'Germany' ],
   [ 'cran.usk.ac.id', 'Indonesia' ],
   [ 'cran.wu.ac.at', 'Austria' ],
   [ 'cran.wustl.edu', 'USA' ],
   [ 'cran.yu.ac.kr', 'Korea' ],
   [ 'ctan.altspu.ru', 'Russia' ],
   [ 'ctan.asis.sh', 'Iran' ],
   [ 'ctan.crest.fr', 'France' ],
   [ 'ctan.dcc.uchile.cl', 'Chile' ],
   [ 'ctan.ebinger.cc', 'Germany' ],
   [ 'ctan.fisiquimicamente.com', 'Spain' ],
   [ 'ctan.gutenberg-asso.fr', 'France' ],
   [ 'ctan.ijs.si', 'Slovenia' ],
   [ 'ctan.javinator9889.com', 'Spain' ],
   [ 'ctan.joethei.xyz', 'Germany' ],
   [ 'ctan.math.ca', 'Canada' ],
   [ 'ctan.math.illinois.edu', 'USA' ],
   [ 'ctan.math.utah.edu', 'USA' ],
   [ 'ctan.math.washington.edu', 'USA' ],
   [ 'ctan.mines-albi.fr', 'France' ],
   [ 'ctan.mirror.globo.tech', 'Canada' ],
   [ 'ctan.mirror.rafal.ca', 'Canada' ],
   [ 'ctan.mirror.twds.com.tw', 'Taiwan' ],
   [ 'ctan.net', 'Germany' ],
   [ 'ctan.tetaneutral.net', 'France' ],
   [ 'ctan.uib.no', 'Norway' ],
   [ 'ctan.yazd.ac.ir', 'Iran' ],
   [ 'dante.ctan.org', 'Germany' ],
   [ 'distrib-coffee.ipsl.jussieu.fr', 'France' ],
   [ 'download.nus.edu.sg', 'Singapore' ],
   [ 'espejito.fder.edu.uy', 'Uruguay' ],
   [ 'fosszone.csd.auth.gr', 'Greece' ],
   [ 'ftp.acc.umu.se', 'Sweden' ],
   [ 'ftp.agdsn.de', 'Germany' ],
   [ 'ftp.belnet.be', 'Belgium' ],
   [ 'ftp.cc.uoc.gr', 'Greece' ],
   [ 'ftp.cixug.es', 'Spain' ],
   [ 'ftp.cvut.cz', 'The Czech Republic' ],
   [ 'ftp.eq.uc.pt', 'Portugal' ],
   [ 'ftp.fagskolen.gjovik.no', 'Norway' ],
   [ 'ftp.fau.de', 'Germany' ],
   [ 'ftp.fu-berlin.de', 'Germany' ],
   [ 'ftp.gwdg.de', 'Germany' ],
   [ 'ftp.heanet.ie', 'Ireland' ],
   [ 'ftp.jaist.ac.jp', 'Japan' ],
   [ 'ftp.kaist.ac.kr', 'Korea' ],
   [ 'ftp.kddilabs.jp', 'Japan' ],
   [ 'ftp.mpi-sb.mpg.de', 'Germany' ],
   [ 'ftp.ntua.gr', 'Greece' ],
   [ 'ftp.osuosl.org', 'USA' ],
   [ 'ftp.rrze.uni-erlangen.de', 'Germany' ],
   [ 'ftp.rrzn.uni-hannover.de', 'Germany' ],
   [ 'ftp.snt.utwente.nl', 'The Netherlands' ],
   [ 'ftp.sun.ac.za', 'South Africa' ],
   [ 'ftp.tu-chemnitz.de', 'Germany' ],
   [ 'ftp.uni-sofia.bg', 'Bulgaria' ],
   [ 'ftp.ussg.iu.edu', 'USA' ],
   [ 'ftp.yz.yamagata-u.ac.jp', 'Japan' ],
   [ 'ftpmirror1.infania.net', 'Sweden' ],
   [ 'ibiblio.org', 'USA' ],
   [ 'lib.stat.cmu.edu', 'USA' ],
   [ 'linorg.usp.br', 'Brazil' ],
   [ 'markov.htwsaar.de', 'Germany' ],
   [ 'mirror-hk.koddos.net', 'China' ],
   [ 'mirror.aarnet.edu.au', 'Australia' ],
   [ 'mirror.bardia.tech', 'Iran' ],
   [ 'mirror.bjtu.edu.cn', 'China' ],
   [ 'mirror.cedia.org.ec', 'Ecuador' ],
   [ 'mirror.clientvps.com', 'Germany' ],
   [ 'mirror.csclub.uwaterloo.ca', 'Canada' ],
   [ 'mirror.cse.unsw.edu.au', 'Australia' ],
   [ 'mirror.datacenter.by', 'Belarus' ],
   [ 'mirror.dogado.de', 'Germany' ],
   [ 'mirror.easyname.at', 'Austria' ],
   [ 'mirror.fcaglp.unlp.edu.ar', 'Argentina' ],
   [ 'mirror.foobar.to', 'Switzerland' ],
   [ 'mirror.funkfreundelandshut.de', 'Germany' ],
   [ 'mirror.ibcp.fr', 'France' ],
   [ 'mirror.init7.net', 'Switzerland' ],
   [ 'mirror.its.dal.ca', 'Canada' ],
   [ 'mirror.kku.ac.th', 'Thailand' ],
   [ 'mirror.koddos.net', 'The Netherlands' ],
   [ 'mirror.kumi.systems', 'Austria' ],
   [ 'mirror.las.iastate.edu', 'USA' ],
   [ 'mirror.lyrahosting.com', 'Netherlands' ],
   [ 'mirror.lyrahosting.com', 'The Netherlands' ],
   [ 'mirror.lzu.edu.cn', 'China' ],
   [ 'mirror.macomnet.net', 'Russia' ],
   [ 'mirror.marwan.ma', 'Morocco' ],
   [ 'mirror.math.princeton.edu', 'USA' ],
   [ 'mirror.metanet.ch', 'Switzerland' ],
   [ 'mirror.mwt.me', 'USA' ],
   [ 'mirror.navercorp.com', 'Korea' ],
   [ 'mirror.niser.ac.in', 'India' ],
   [ 'mirror.nyist.edu.cn', 'China' ],
   [ 'mirror.ox.ac.uk', 'United Kingdom' ],
   [ 'mirror.physik.tu-berlin.de', 'Germany' ],
   [ 'mirror.quantum5.ca', 'Canada' ],
   [ 'mirror.rcg.sfu.ca', 'Canada' ],
   [ 'mirror.szerverem.hu', 'Hungary' ],
   [ 'mirror.truenetwork.ru', 'Russia' ],
   [ 'mirror.ufs.ac.za', 'South Africa' ],
   [ 'mirror.uned.ac.cr', 'Costa Rica' ],
   [ 'mirror.unpad.ac.id', 'Indonesia' ],
   [ 'mirror2.sandyriver.net', 'USA' ],
   [ 'mirrors.aliyun.com', 'China' ],
   [ 'mirrors.bfsu.edu.cn', 'China' ],
   [ 'mirrors.cloud.tencent.com', 'China' ],
   [ 'mirrors.cqu.edu.cn', 'China' ],
   [ 'mirrors.dotsrc.org', 'Denmark' ],
   [ 'mirrors.e-ducation.cn', 'China' ],
   [ 'mirrors.evoluso.com', 'Netherlands' ],
   [ 'mirrors.evoluso.com', 'The Netherlands' ],
   [ 'mirrors.hit.edu.cn', 'China' ],
   [ 'mirrors.hoobly.com', 'USA' ],
   [ 'mirrors.ircam.fr', 'France' ],
   [ 'mirrors.jlu.edu.cn', 'China' ],
   [ 'mirrors.mi-ras.ru', 'Russia' ],
   [ 'mirrors.mit.edu', 'USA' ],
   [ 'mirrors.nic.cz', 'Czech Republic' ],
   [ 'mirrors.nic.cz', 'The Czech Republic' ],
   [ 'mirrors.nics.utk.edu', 'USA' ],
   [ 'mirrors.nju.edu.cn', 'China' ],
   [ 'mirrors.nxthost.com', 'Romania' ],
   [ 'mirrors.pku.edu.cn', 'China' ],
   [ 'mirrors.psu.ac.th', 'Thailand' ],
   [ 'mirrors.qlu.edu.cn', 'China' ],
   [ 'mirrors.rit.edu', 'USA' ],
   [ 'mirrors.sjtug.sjtu.edu.cn', 'China' ],
   [ 'mirrors.sustech.edu.cn', 'China' ],
   [ 'mirrors.tuna.tsinghua.edu.cn', 'China' ],
   [ 'mirrors.ucr.ac.cr', 'Costa Rica' ],
   [ 'mirrors.up.pt', 'Portugal' ],
   [ 'mirrors.upm.edu.my', 'Malaysia' ],
   [ 'mirrors.ustc.edu.cn', 'China' ],
   [ 'mirrors.zju.edu.cn', 'China' ],
   [ 'muug.ca', 'Canada' ],
   [ 'osl.ugr.es', 'Spain' ],
   [ 'packages.oth-regensburg.de', 'Germany' ],
   [ 'packages.othr.de', 'Germany' ],
   [ 'pbil.univ-lyon1.fr', 'France' ],
   [ 'polish-mirror.evolution-host.com', 'Poland' ],
   [ 'repo.miserver.it.umich.edu', 'USA' ],
   [ 'repo.skni.umcs.pl', 'Poland' ],
   [ 'repo.ugm.ac.id', 'Indonesia' ],
   [ 'sendinnsky.selfhost.co', 'Germany' ],
   [ 'stat.ethz.ch', 'Switzerland' ],
   [ 'sunsite.icm.edu.pl', 'Poland' ],
   [ 'sunsite.informatik.rwth-aachen.de', 'Germany' ],
   [ 'texlive.info', 'Finland' ],
   [ 'texlive.mycozy.space', 'France' ],
   [ 'tug.ctan.org', 'USA' ],
   [ 'vps.fmvz.usp.br', 'Brazil' ],
   [ 'www-uxsup.csx.cam.ac.uk', 'United Kingdom' ],
   [ 'www.est.colpos.mx', 'Mexico' ],
   [ 'www.freestatistics.org', 'Belgium' ],
   [ 'www.icesi.edu.co', 'Colombia' ],
   [ 'www.stats.bris.ac.uk', 'UK' ]
]


os.makedirs(resultsDirectory, exist_ok = True)
destinationTable = open(os.path.join(resultsDirectory, 'destinations.csv'), 'w', encoding='utf-8')
destinationTable.write('Destination\tReverseLookup\tLocation\tAddress\n')

for destination in destinations:
   destinationName     = destination[0]
   destinationLocation = destination[1]
   try:
      addrInfos = socket.getaddrinfo(destinationName, 80, proto=socket.IPPROTO_TCP)
      print('Processing ' + destinationName + ' ...')
      for addrInfo in addrInfos:
         address = ipaddress.ip_address(addrInfo[4][0])
         try:
            nameInfo = socket.getnameinfo( (str(address), 80), socket.NI_NUMERICSERV)
            nameInfo = nameInfo[0]
         except:
            nameInfo = None
         destinationTable.write(destinationName + '\t' + str(nameInfo) + '\t"' +
                                destinationLocation + '"\t' + str(address) + '\n')
   except Exception as e:
      print('FAILED: ' + str(e))

destinationTable.close()
