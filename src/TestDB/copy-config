#!/bin/bash

# Copy configuration from dbtest VM:
if [ $# -ne 1 ] ; then
   echo >&2 "Usage: $0 user@server"
   exit 1
fi
SERVER="${1//*@/}"
USER="${1//@*/}"
if [ "${USER}" == "${SERVER}" ] ; then
   USER="nornetpp"
fi


echo -e "\x1b[34mCopying database access configuration from test server ...\x1b[0m"

scp ${USER}@${SERVER}:testdb-* ${HOME}/ && \
scp ${USER}@${SERVER}:/etc/ssl/TestLevel1/certs/TestLevel1.crt ${HOME}/ && \
scp ${USER}@${SERVER}:/etc/ssl/TestGlobal.crl ${HOME}/
sed -e "s/^\(dbserver[ \t]*\)=.*\$/\1= ${SERVER}/g" \
    -e "s#^\(dbcafile[ \t]*\)=.*\$#\1= ${HOME}/TestLevel1.crt#g" \
    -e "s#^\(dbcrlfile[ \t]*\)=.*\$#\1= ${HOME}/TestGlobal.crl#g" \
    -i ${HOME}/testdb-*.conf

echo -e "\x1b[34mDone!\x1b[0m"
